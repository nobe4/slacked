#!/usr/bin/env bash
# Usage: release PLATFORM

set -e

PLATFORM="${1:?}"
SOURCE=".goreleaser.yaml"
DEST=".goreleaser.generated.yaml"

case "$PLATFORM" in
    linux   ) sed '/- id: windows/,/^$/d; /- id: darwin/,/^$/d' "${SOURCE}" > "${DEST}" ;;
    darwin  ) sed '/- id: windows/,/^$/d; /- id: linux/,/^$/d'  "${SOURCE}" > "${DEST}" ;;
    windows ) sed '/- id: linux/,/^$/d; /- id: darwin/,/^$/d'   "${SOURCE}" > "${DEST}" ;;
    * ) echo "Unsupported platform: $PLATFORM" && exit 1 ;;
esac

# TODO: remove `--snapshot`
goreleaser release --snapshot --config "${DEST}" --clean --skip=publish
